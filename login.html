<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>MOH | Login</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="css/plugins/summernote/summernote-bs4.css" rel="stylesheet">

    <link href="css/plugins/datapicker/datepicker3.css" rel="stylesheet">

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

</head>

<body class="gray-bg">

    <div class="middle-box text-center loginscreen animated fadeInDown">
        <div>
            <div>

                <h1 class="logo-name">DA+</h1>

            </div>
            <h3>Welcome to Disease Analytic System</h3>
            <p>Assist healthcare professionals in identifying, tracking, and analyzing patterns of disease occurrence and transmission.
            </p>
            <p>Login in. To see it in action.</p>
            <form class="m-t" role="form" action="index.html">
                <div class="form-group">
                    <input type="email" id="email" class="form-control" placeholder="Username" required="">
                </div>
                <div class="form-group">
                    <input type="password" id="password" class="form-control" placeholder="Password" required="">
                </div>
                <button type="submit" class="btn btn-primary block full-width m-b" id="loginUser">Login</button>

                <a href="forgot_password.html"><small>Forgot password?</small></a>
            </form>
            <p class="m-t"> <small><strong>Copyright</strong> ADJ Company &copy; 2023-2024</small> </p>
        </div>
    </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.js"></script>

    <script src="./js/config.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
        import { getDatabase , set, ref, update, onValue} from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword} from "https://www.gstatic.com/firebasejs/9.19.1/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        var database = getDatabase(app);
        const auth = getAuth();
    
        document.getElementById("loginUser").addEventListener("click", loginUser);
    
        function loginUser(event){
            event.preventDefault()
    
        var email = getElementVal('email');
        var password = getElementVal('password');
    
        signInWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
                // Signed in 
                const user = userCredential.user;

                const dt = new Date();
                update(ref(database,'user_roles/'+ user.uid),{
                    last_login : dt 
                });

                onValue(ref(database,'user_roles/'+ user.uid), (snapshot) => {
                    var userRole = snapshot.val().selectRole;

                    if (userRole == 'MOH Admin'){
                        window.location.href = "add_phi.html";
                    }
                    else if (userRole == 'Hospital Admin'){
                        window.location.href = "add_patient.html";
                    }
                    else if  (userRole == 'System Admin'){
                        window.location.href = "google_maps.html";
                    }
                    else{
                        window.location.href = "google_maps.html";
                    }
                    
                });

                // ...
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
            });
        }
    
        const getElementVal = (id) => {
            return document.getElementById(id).value;
        }
    </script>

</body>

</html>
